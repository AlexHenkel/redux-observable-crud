# Overview

Provides a redux-observer CRUD functions generator, to have a nice DRY code on observer files. This will increase scalability and maintainability as there's only one file to maintain.

Observables here are used in the following way:

1. Listen to a redux request action.
2. If the action is intended to call API, verify if matching info already exists and fire a success redux action.
3. Call API
4. If API call is success, fire a success redux action with transformed data. Else, fire a failure redux action with error

More about [redux-observable](https://redux-observable.js.org/docs/basics/Epics.html)

It supports five major CRUD actions, and 3 subactions to sync data with state and simulate hot refreshing:

- **Get**: Action to get all valid records. Ex. `GET: api.dev/collection`
- **Get One**: Action to get one record by id. Ex. `GET: api.dev/collection/{id}`
- **Create**: Action to add a record to collection. Ex. `POST: api.dev/collection`
- **Update**: Action to update a record by id. Ex. `POST: api.dev/collection/{id}`
- **Remove**: Action to update a record by id. Ex. `POST: api.dev/collection/{id}`

- **Create Success**: Action to update existing data on create success
- **Update Success**: Action to update existing data on update success
- **Remove Success**: Action to update existing data on remove success

## Installation

Add the package to `bower.json` file:
```
"reduxobserver-crudsauce": "https://BITBUCKET_USER@bitbucket.org/kinedu/reduxobserver-crudsauce.git",
```

Run:
```
bower update
```

## Usage Example

Import library, *Redux Observable* to add more custom observables, and all Redux files used in the observer. Then, call main method: `createCRUDObserver` with an object as parameter, this will contain all the setup: 
```
<script src="../../../node_modules/rxjs/bundles/Rx.js"></script>
<script src="../../../node_modules/redux-observable/dist/redux-observable.js"></script>
<link rel="import" href="../redux/networks-redux.html">
<link rel="import" href="../redux/countries-redux.html">

<script>
  const { observers, epic } = createCRUDObserver({
    mainRedux: NetworksRedux,
    reduxPath: 'networks',
    modifier: (result) => {
      const { country } = result;
      result.country_id = country ? country.id : null; 
      return result;
    },
    create: {
      onSuccessActions: [
        {
          redux: CountriesRedux,
          filter: (country, item) => item.country === country.name,
        },
      ],
    },
    update: {
      onSuccessActions: [
        {
          redux: CountriesRedux,
        },
      ],
    },
    remove: {
      onSuccessActions: [
        {
          redux: CountriesRedux,
        },
      ],
    },
  });

  // For testing
  const networksObservers = observers;

  const networksEpic = epic;
</script>

```

In this example we are creatinig observables for `networks` collection and syncing with `countries`

The function returns an object of `observables` for testing andÂ `epic`, which can be combined to other epics to setup **Redux Middleware**

## Options

`mainRedux` (Required)
This is the Redux file of the collection. This should be generated by `reduxsauce-polymer`.

`reduxPath` (Required)
Name of the state path declared on redux state. Generally, it should be the name of the collection in lowercase plural.

`modifier` (Optional)
Function to manipulate API result. It's used to calculate and add fields based on other fields. If it's not provided, data will not be transformed.

`create.onSuccessActions update.onSuccessActions, remove.onSuccessActions` (Optional)
This will be an array of Redux options to sync data in other redux that may contain same information.

`onSuccessActions.redux` (Required if past option is present)
Redux file of the collection that needs to be synced

`create.onSuccessActions.filter` (Optional)
Filter to decide if new object should be included to other Redux file. For example, Country is a collection that contains networks; when a network is created, we should verify that network belongs to country in order to add new item.
